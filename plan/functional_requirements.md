# Функциональные требования

## Получение доступных слотов

**Метод:** `GET /slots/availability`

**Пример ответа:**

[
    { "slot_id": 1, "capacity": 10, "remaining": 6 },
    { "slot_id": 2, "capacity": 5, "remaining": 0 }
]

**Требования:**

- Кешировать результат на **5–15 секунд**, предусмотреть защиту от *cache stampede*.
- После подтверждения или отмены данных **инвалидировать кеш**.

---

## Создание холда

**Метод:** `POST /slots/{id}/hold`

**Заголовок:**

- `Idempotency-Key: <UUID>`

**Требования:**

- Создает запись в таблице `holds` со статусом `held`.
- Проверяет доступность мест и возвращает `409 Conflict`, если `capacity` исчерпан.
- Повторный запрос с тем же ключом возвращает прежний результат (**идемпотентность**).
- Холды живут **5 минут** (фоновую очистку можно не реализовывать).

---

## Подтверждение холда

**Метод:** `POST /holds/{id}/confirm`

**Требования:**

- Переводит холд в состояние `confirmed`.
- Атомарно уменьшает `remaining` в слоте на `1` с защитой от оверсела.
- При отсутствии мест возвращает `409 Conflict`.
- После успешного подтверждения **инвалидирует кеш доступности**.

---

## Отмена холда

**Метод:** `DELETE /holds/{id}`

**Требования:**

- Меняет состояние холда на `cancelled`.
- Возвращает слот в доступ, обновляя остаток.
- **Инвалидирует кеш** доступных слотов.
